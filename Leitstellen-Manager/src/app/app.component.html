<p-toolbar>
  <div class="p-toolbar-group-left">
    <p-button label="Alle" icon="pi pi-plus" class="p-mr-2" (click)="filterBuildings(false)"></p-button>
    <p-button label="Nur Unfertige Wachen" icon="pi pi-minus" class="p-mr-2" (click)="filterBuildings(true)">
    </p-button>

    <!-- <i class="p-toolbar-separator pi pi-bars p-mr-2" style="vertical-align: middle"></i> -->
  </div>

  <div class="p-toolbar-group-right">
    <p-button icon="pi pi-spin pi-spinner" class="p-mr-2" (click)="getVehicleData()"></p-button>
  </div>
</p-toolbar>

<div class="p-grid peter">
  <div class="p-col-4 box">
    <p-table #dt1 [value]="buildingsTable" [globalFilterFields]="['type', 'name', 'city']" selectionMode="single"
      [(selection)]="selectedBuilding" dataKey="id" [scrollable]="true" scrollHeight="78vh" sortMode="multiple"
      [resizableColumns]="true">
      <ng-template pTemplate="colgroup">
        <colgroup>
          <col>
          <col>
          <col>
          <col>
          <col>
        </colgroup>
      </ng-template>
      <ng-template pTemplate="caption">
        <div class="p-d-flex">
          <!-- <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
            (click)="clear(dt1)"></button> -->
          <span class="p-input-icon-left p-ml-auto">
            <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
              placeholder="Suche" />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pResizableColumn pSortableColumn="type">Type</th>
          <th pResizableColumn pSortableColumn="city">Stadt</th>
          <th pResizableColumn pSortableColumn="name">Wache</th>
          <th pResizableColumn pSortableColumn="increaseLevel">Level</th>
          <th pResizableColumn pSortableColumn="vehicles">Fahrzeuge</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-building>
        <tr [pSelectableRow]="building">
          <td>{{buildingTypes[building.type].name}}</td>
          <td>{{building.city}}</td>
          <td>{{building.name}}</td>
          <td>
            <div [ngClass]="building.increaseLevel ? 'redText' : 'greenText'">{{building.level}}</div>
          </td>
          <td>
            <div [ngClass]="building.vehicleDiff.length > 0 || !building.personalPasst ? 'redText' : 'greenText'">
              {{building.vehicles.length}}</div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <div class="p-col box">
    <button pButton type="button" label="Click" class="buildingButton" (click)="openBuildingTab()"></button>

    <p-tabView>
      <p-tabPanel header="Allgemein" *ngIf="selectedBuilding != null">
        ID: {{selectedBuilding ? selectedBuilding.id : ''}}<br />
        Type (Game): {{selectedBuilding ? selectedBuilding.building_type : ''}}<br />
        Type (Unser): {{selectedBuilding ? selectedBuilding.type : ''}}<br />
        Stadt: {{selectedBuilding ? selectedBuilding.city : ''}}<br />
        Name: {{selectedBuilding ? selectedBuilding.name : ''}}<br />
        Lst: {{selectedBuilding ? selectedBuilding.leitstelle_building_id : ''}}<br />
        Level: {{selectedBuilding ? selectedBuilding.level : ''}}<br />
        Level passt? : {{selectedBuilding ? !selectedBuilding.increaseLevel : ''}}<br />
        Personal passt?: {{selectedBuilding ? selectedBuilding.personalPasst : ''}}<br />
        vehicleDiff passt (0)? : {{selectedBuilding ? selectedBuilding.vehicleDiff.length : ''}}<br />
      </p-tabPanel>
      <p-tabPanel header="Fahrzeuge" *ngIf="selectedBuilding != null">
        <p-table [value]="selectedBuilding.vehicles">
          <ng-template pTemplate="header">
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Status</th>
              <th>Personal</th>
              <th colspan="2">Links</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-vehicle>
            <tr>
              <td>{{vehicle.caption}}</td>
              <td>{{vehicle.vehicle_type}}</td>
              <td><div [ngClass]="vehicle.fms_real == 6 ? 'redText' : ''">{{vehicle.fms_show}}</div></td>
              <td>
                <div [ngClass]="!vehicle.personalPasst ? 'redText' : ''">
                  {{vehicle.assigned_personnel_count}} (min. {{vehicleTypes[vehicle.vehicle_type] ? vehicleTypes[vehicle.vehicle_type].minPersonal : 'Fehler'}})</div>
              </td>
              <td colspan="2">
                <p-button class="p-mr-1" label="Ãœbersicht" (click)="openVehicleTab(vehicle.id)"></p-button>
                <p-button class="p-mr-1" label="Personal" (click)="openVehiclePersonalTab(vehicle.id)"></p-button>
                <p-button class="p-mr-1" label="Status" (click)="openVehicleStatusTab(vehicle.id, vehicle.fms_real)"></p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>

        <div *ngIf="selectedBuilding.vehicleDiff != null && selectedBuilding.vehicleDiff.length > 0">
          <br /> Differenz zum Soll <br />
          <p-table [value]="selectedBuilding.vehicleDiff">
            <ng-template pTemplate="header">
              <tr>
                <th>Fahrzeug</th>
                <th>Anzahl</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-vehicle>
              <tr>
                <td>{{vehicleTypes[vehicle.type] ? vehicleTypes[vehicle.type].name : 'Fehlendes Fahrzeug ' + vehicle.type}}</td>
                <td>
                  {{vehicle.count < 0 ? abs(vehicle.count) + ' zu viel' : vehicle.count + (vehicle.count == 1 ? ' fehlt' : ' fehlen')}}
                </td>
                <td>
                  <p-button class="p-mr-2" label="Kaufen" (click)="openBuyVehicleTab(selectedBuilding.id, vehicle.type)"></p-button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>
